<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pocket Corridor Table (sd/df)</title>

  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0b0f14" />
  <link rel="icon" href="icon-192.png" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <header>
    <h1>Pocket Corridor Table (sd/df)</h1>
    <p class="sub">PCPT table + corridor calculator (Δ, V, Δop → R, sin²φ, CRS)</p>
  </header>

  <main>
    <!-- 1) Calculator -->
    <section class="card" id="calculator">
      <h2>1) 2×2 Calculator (from the paper)</h2>

      <div class="grid">
        <label for="delta">Δ (eV)
          <input
            id="delta"
            type="text"
            inputmode="decimal"
            lang="en"
            autocomplete="off"
            spellcheck="false"
            placeholder="1.0"
            value="1.0"
          />
        </label>

        <label for="V">V (eV)
          <input
            id="V"
            type="text"
            inputmode="decimal"
            lang="en"
            autocomplete="off"
            spellcheck="false"
            placeholder="0.5"
            value="0.5"
          />
        </label>

        <label for="dop">Δop (eV)
          <input
            id="dop"
            type="text"
            inputmode="decimal"
            lang="en"
            autocomplete="off"
            spellcheck="false"
            placeholder="0.2"
            value="0.2"
          />
        </label>

        <label for="T">T (K) (optional)
          <input
            id="T"
            type="text"
            inputmode="numeric"
            lang="en"
            autocomplete="off"
            spellcheck="false"
            placeholder="300"
            value="300"
          />
        </label>
      </div>

      <button id="calc" type="button">Calculate</button>

      <div class="out" id="out" aria-live="polite"></div>

      <details class="small">
        <summary>Formulas (audit)</summary>
        <pre>
R      = |Δ| / |V|
sin²φ  = 1/2 · (1 − Δ / √(Δ² + 4V²))
Δmix   = √(Δ² + 4V²)
kBT(eV)= 8.617333262e−5 · T

CRS heuristic (editable):
  CRS = 0 if Δop ≥ 0.5 and R ≥ 5
  CRS = 1 if Δop ≥ 0.2 and R ≥ 2
  CRS = 2 if Δop ≥ 0.1 and R ≥ 1
  else CRS = 3
        </pre>
      </details>
    </section>

    <!-- 2) Periodic Table (clickable) -->
    <section class="card" id="ptableCard">
      <h2>2) Periodic Table (click an element)</h2>
      <p class="small">
        Click an element to show its corridor metadata (CRS / DMC / note) from <code>data/pcpt.csv</code>.
        (The grid is generated by <code>app.js</code>.)
      </p>

      <!-- Optional legend/help slots (filled by JS later) -->
      <div id="ptLegend" class="small"></div>

      <!-- The periodic table grid is rendered here -->
      <div id="ptable" class="ptable" aria-label="Periodic table"></div>

      <!-- Clicked element details -->
      <div id="elementDetails" class="details" aria-live="polite" style="display:none;">
        <h3 id="detailsTitle" style="margin:0 0 8px 0;">Element</h3>
        <div class="small" id="detailsBody"></div>
      </div>

      <!-- Human-readable explainer (can be filled by JS, but works as static HTML too) -->
      <details class="small" style="margin-top:10px">
        <summary>What do CRS and DMC mean?</summary>
        <div id="ptHelp" style="margin-top:8px; line-height:1.45;">
          <p>
            <b>CRS</b> (Corridor Risk Score, 0–3) is a discrete risk flag: how likely the system is to enter a near-degeneracy
            “corridor” where small chemical changes can flip frontier-orbital character and related observables.
          </p>

          <ul style="margin:6px 0 0 18px; padding:0">
            <li><b>0</b>: robust / far from corridor</li>
            <li><b>1</b>: mild sensitivity</li>
            <li><b>2</b>: corridor-prone / strong sensitivity</li>
            <li><b>3</b>: critical / very corridor-like</li>
          </ul>

          <p style="margin-top:10px">
            <b>DMC</b> (Dominant Mixing Cue) labels the dominant physical mechanism driving the mixing/instability:
          </p>

          <ul style="margin:6px 0 0 18px; padding:0">
            <li><b>d↔d</b>: intra-d competition (ligand field, oxidation, redox states)</li>
            <li><b>SC</b>: spin crossover (HS↔LS)</li>
            <li><b>SOC</b>: spin–orbit coupling / relativistic reordering (heavy elements)</li>
            <li><b>s↔d</b>, <b>p↔d</b>, <b>f/rel</b>: other channel competitions / strong relativistic or f-shell effects</li>
          </ul>

          <p class="small" style="margin-top:10px">
            Note: only a subset of elements currently has PCPT metadata. Missing entries appear uncolored and will show
            “No PCPT entry” when clicked.
          </p>
        </div>
      </details>
    </section>

    <!-- 3) PCPT table from CSV -->
    <section class="card" id="pcptCsv">
      <h2>3) PCPT by element (CSV)</h2>
      <p class="small">
        File: <code>data/pcpt.csv</code> (symbol, CRS, DMC, note). The table below loads this CSV.
      </p>

      <div class="toolbar">
        <input
          id="filter"
          type="search"
          inputmode="search"
          lang="en"
          autocomplete="off"
          spellcheck="false"
          placeholder="Filter by symbol (e.g., Fe) or DMC (e.g., SOC)"
        />
        <button id="reload" type="button">Reload CSV</button>
      </div>

      <div id="pcptTable"></div>
    </section>

    <!-- 4) Optional cases -->
    <section class="card" id="cases">
      <h2>4) Case dataset (synthesis/complexes) — optional</h2>
      <p class="small">
        File: <code>data/cases.csv</code> with (Δ, V, Δop, θ, observable) to attach real data and generate reports.
      </p>
      <div id="casesTable"></div>
    </section>
  </main>

  <footer class="small">
    <p>
      Offline: this site registers a Service Worker when served over HTTPS (Netlify/GitHub Pages).
      If opened as a local file (file://), the PWA will not install.
    </p>
  </footer>

  <script src="app.js"></script>
</body>
</html>
